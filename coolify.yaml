# Coolify Configuration for AstroWind with Nixpacks
# This file configures the deployment settings for Coolify

# Build Configuration
buildpack: nixpacks
buildCommand: npm ci && npm run build
startCommand: npx serve dist -p 3000

# Environment Variables
environment:
  NODE_ENV: production
  PORT: 3000
  NIXPACKS_NO_CACHE: 'false'

# Traefik Labels for Reverse Proxy
labels:
  - 'traefik.enable=true'
  - 'traefik.http.routers.astrowind.rule=Host(`romahomestore.com`)'
  - 'traefik.http.routers.astrowind.entrypoints=websecure'
  - 'traefik.http.routers.astrowind.tls.certresolver=letsencrypt'
  - 'traefik.http.services.astrowind.loadbalancer.server.port=3000'
  - 'traefik.docker.network=traefik'

# Health Check
healthcheck:
  path: /
  port: 3000
  interval: 30s
  timeout: 10s
  retries: 3
  start_period: 40s
